LogiSync Database Schema
Updated: 2025-01-23
Based on consolidated Laravel migrations (19 migration files)

=====================================================
DATABASE STRUCTURE OVERVIEW
=====================================================

Total Tables: 17 tables + 2 Laravel system tables (cache, jobs)

Multi-Tenancy: Organization-based (organization_id)
Currency Storage: All amounts stored in centavos (₱336.00 = 33600)

=====================================================
TABLE LIST (in migration order)
=====================================================

1.  organizations         - Multi-tenant organization data
2.  users                 - User accounts with roles
3.  subscriptions         - Subscription plans (Free, Pro, Enterprise)
4.  warehouse             - Warehouse locations
5.  budgets               - Budget allocations
6.  schedules             - Delivery/transport schedules
7.  quotes                - Price quotations
8.  orders                - Customer orders
9.  transport             - Vehicles and transport details
10. shipments             - Shipment tracking (includes receiver_email)
11. invoices              - Billing invoices
12. order_details         - Order line items
13. inventory             - Warehouse inventory
14. tracking_history      - Shipment status history
15. user_subscriptions    - User subscription assignments
16. gps_locations         - Real-time GPS tracking
17. pricing_config        - Dynamic pricing configuration

=====================================================
DETAILED TABLE SCHEMAS
=====================================================

1. ORGANIZATIONS
   - organization_id (PK, BIGINT)
   - name
   - email
   - phone
   - address
   - timestamps

2. USERS
   - user_id (PK, INT)
   - organization_id (FK -> organizations) *MULTI-TENANCY*
   - created_by (FK -> users, self-reference)
   - username (UNIQUE)
   - password (hashed)
   - role (admin, driver, warehouse_manager, etc.)
   - email (UNIQUE)
   - email_verification_code
   - email_verification_code_expires_at
   - email_verified (BOOLEAN)

3. SUBSCRIPTIONS
   - subscription_id (PK, INT)
   - plan_name (Free, Pro, Enterprise)
   - slug (free, pro, enterprise)
   - description
   - price (INT, in centavos)
   - term_months
   - paymongo_payment_link_id
   - active (BOOLEAN)

4. WAREHOUSE
   - warehouse_id (PK, INT)
   - organization_id (FK -> organizations) *MULTI-TENANCY*
   - warehouse_name
   - location

5. BUDGETS
   - budget_id (PK, INT)
   - organization_id (FK -> organizations) *MULTI-TENANCY*
   - budget_name
   - start_date
   - end_date
   - total_budget (INT, in centavos)

6. SCHEDULES
   - schedule_id (PK, INT)
   - organization_id (FK -> organizations) *MULTI-TENANCY*
   - schedule_name
   - start_time (DATETIME)
   - end_time (DATETIME)
   - route_details

7. QUOTES
   - quote_id (PK, INT)
   - organization_id (FK -> organizations) *MULTI-TENANCY*
   - quote_number (UNIQUE, auto-generated: Q-00001)
   - customer_name
   - created_by_user_id (FK -> users)
   - creation_date (TIMESTAMP)
   - weight (INT)
   - dimensions
   - estimated_cost (INT, in centavos)
   - expiry_date
   - status (pending, accepted, rejected)
   - distance (INT, in km)

8. ORDERS
   - order_id (PK, INT)
   - order_number (UNIQUE, auto-generated: ORD-00001)
   - organization_id (FK -> organizations) *MULTI-TENANCY*
   - quote_id (FK -> quotes, nullable)
   - customer_name
   - order_date (TIMESTAMP)
   - order_status (pending, processing, shipped, delivered)

9. TRANSPORT
   - transport_id (PK, INT)
   - organization_id (FK -> organizations) *MULTI-TENANCY*
   - vehicle_id
   - vehicle_type
   - registration_number (UNIQUE)
   - capacity
   - safety_compliance_details
   - driver_id (FK -> users)
   - budget_id (FK -> budgets)
   - schedule_id (FK -> schedules)

10. SHIPMENTS **INCLUDES EMAIL TRACKING**
    - shipment_id (PK, INT)
    - tracking_number (UNIQUE, auto-generated: LS-XXXXXX)
    - receiver_name
    - receiver_contact
    - receiver_email **NEW - for automatic tracking notifications**
    - receiver_address
    - origin_name
    - origin_address
    - destination_name
    - destination_address
    - creation_date (TIMESTAMP)
    - charges (INT, in centavos)
    - status (pending, in_transit, delivered)
    - departure_date
    - order_id (FK -> orders)
    - transport_id (FK -> transport)

11. INVOICES
    - invoice_id (PK, INT)
    - invoice_number (UNIQUE, auto-generated: INV-00001)
    - order_id (FK -> orders)
    - shipment_id (FK -> shipments, nullable)
    - quote_id (FK -> quotes, nullable)
    - invoice_type
    - invoice_date
    - due_date
    - amount (INT, in centavos)
    - status (pending, paid, overdue)
    - payment_date
    - payment_method
    - notes

12. ORDER_DETAILS
    - order_details_id (PK, INT)
    - order_id (FK -> orders)
    - product_id
    - quantity

13. INVENTORY
    - inventory_id (PK, INT)
    - warehouse_id (FK -> warehouse)
    - location_in_warehouse
    - order_id (FK -> orders)

14. TRACKING_HISTORY
    - tracking_history_id (PK, INT)
    - shipment_id (FK -> shipments)
    - timestamp (TIMESTAMP)
    - location
    - status
    - details

15. USER_SUBSCRIPTIONS
    - user_subscription_id (PK, INT)
    - user_id (FK -> users)
    - subscription_id (FK -> subscriptions)
    - start_date
    - end_date
    - status (active, expired, cancelled)

16. GPS_LOCATIONS
    - id (PK, BIGINT)
    - shipment_id (FK -> shipments)
    - driver_id (FK -> users)
    - latitude (DECIMAL 10,8)
    - longitude (DECIMAL 11,8)
    - speed (DECIMAL 8,2)
    - accuracy (DECIMAL 8,2)
    - recorded_at (TIMESTAMP)
    - timestamps

17. PRICING_CONFIG
    - config_id (PK, BIGINT)
    - base_rate (DECIMAL 10,2) - default: 100.00
    - per_km_rate (DECIMAL 10,2) - default: 15.00
    - per_kg_rate (DECIMAL 10,2) - default: 5.00
    - fuel_surcharge_percent (DECIMAL 5,2) - default: 10.00
    - insurance_percent (DECIMAL 5,2) - default: 2.00
    - minimum_charge (DECIMAL 10,2) - default: 200.00
    - priority_multiplier (DECIMAL 5,2) - default: 1.50
    - express_multiplier (DECIMAL 5,2) - default: 2.00
    - timestamps

=====================================================
KEY RELATIONSHIPS
=====================================================

organizations (1) -----> (N) users
organizations (1) -----> (N) warehouse
organizations (1) -----> (N) budgets
organizations (1) -----> (N) schedules
organizations (1) -----> (N) quotes
organizations (1) -----> (N) orders
organizations (1) -----> (N) transport

users (1) -----> (N) quotes (created_by_user_id)
users (1) -----> (N) transport (driver_id)
users (1) -----> (N) gps_locations (driver_id)
users (1) -----> (N) user_subscriptions

quotes (1) -----> (N) orders
orders (1) -----> (N) shipments
orders (1) -----> (N) invoices
orders (1) -----> (N) order_details
orders (1) -----> (N) inventory

transport (1) -----> (N) shipments
budgets (1) -----> (N) transport
schedules (1) -----> (N) transport

shipments (1) -----> (N) tracking_history
shipments (1) -----> (N) gps_locations
shipments (1) -----> (1) invoices (nullable)

warehouse (1) -----> (N) inventory

subscriptions (1) -----> (N) user_subscriptions

=====================================================
IMPORTANT NOTES
=====================================================

1. MULTI-TENANCY
   - All resource tables include organization_id
   - Data is isolated by organization
   - Users belong to one organization
   - Resources (warehouse, budgets, schedules, quotes, orders, transport)
     are scoped to organizations

2. CURRENCY STORAGE
   - ALL monetary amounts stored in centavos (multiply by 100)
   - Examples:
     * ₱336.00 stored as 33600
     * ₱499.00 (Pro plan) stored as 49900
     * ₱999.00 (Enterprise) stored as 99900
   - Fields affected: price, total_budget, estimated_cost, charges, amount

3. AUTO-GENERATED NUMBERS
   - quote_number: Q-00001, Q-00002, ...
   - order_number: ORD-00001, ORD-00002, ...
   - invoice_number: INV-00001, INV-00002, ...
   - tracking_number: LS-XXXXXX (6 random alphanumeric)

4. EMAIL TRACKING FEATURE
   - receiver_email field in shipments table
   - Automatic email sent on shipment creation
   - Email contains: tracking number, destination, charges
   - Email field is optional (nullable)

5. SUBSCRIPTION PLANS (Seeded automatically)
   - Free: ₱0/month (stored as 0)
   - Pro: ₱499/month (stored as 49900)
   - Enterprise: ₱999/month (stored as 99900)

6. PRICING CONFIG (Seeded with defaults)
   - Dynamic pricing based on weight, distance, and service type
   - Configurable surcharges and multipliers
   - Minimum charge enforced: ₱200.00

7. USER ROLES
   - admin: Full system access
   - driver: Assigned to transport, updates GPS
   - warehouse_manager: Manages inventory
   - booking_manager: Creates quotes and orders
   - (Custom roles can be added)

8. DEVELOPMENT COMMANDS
   - Fresh migration: php artisan migrate:fresh
   - With seed data: php artisan migrate:fresh --seed
   - Rollback: php artisan migrate:rollback
   - Status: php artisan migrate:status

=====================================================
RECENT CHANGES (2025-01-23)
=====================================================

✅ Consolidated migrations from 33 files to 19 files
✅ Added receiver_email to shipments table
✅ Removed Invoice model's setAmountAttribute mutator (double conversion bug)
✅ Updated Inventory model to use customer_name from orders
✅ Added automatic subscription plan seeding
✅ Fixed all multi-tenancy references (user_id -> organization_id)
✅ Added comprehensive SQL documentation
✅ Removed deployment files (still in development)
